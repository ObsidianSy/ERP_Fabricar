import{r as o,a as x,o as u}from"./index-Cc8Dvf1k.js";const L=()=>{const[p,_]=o.useState([]),[h,g]=o.useState([]),[f,m]=o.useState([]),[k,v]=o.useState(null),[E,y]=o.useState(null),[A,c]=o.useState(!1),{toast:n}=x(),I=o.useCallback(async(a,e=30)=>{c(!0);try{const s=await u.listEnviosByCliente(a,e);return _(Array.isArray(s.envios)?s.envios:[]),Array.isArray(s.envios)?s.envios:[]}catch(s){return console.error("Erro ao carregar envios:",s),n({title:"Erro ao carregar envios",description:s.message||"NÃ£o foi possÃ­vel carregar a lista de envios.",variant:"destructive"}),_([]),[]}finally{c(!1)}},[n]),w=o.useCallback(async(a,e)=>{var s,i,l;c(!0);try{const r=await u.getEnvioDetails(a,e),d=Array.isArray(r.registrados)?r.registrados:[],t=Array.isArray(r.pendentes)?r.pendentes:[];return v(r.resumo||null),g(d),m(t),y(((s=r.envio)==null?void 0:s.envio_id)||null),{envioId:((i=r.envio)==null?void 0:i.envio_id)||null,envioNum:((l=r.envio)==null?void 0:l.envio_num)||e,summary:r.resumo||null,items:d,pendings:t}}catch(r){return console.error("Erro ao carregar detalhes do envio:",r),n({title:"Erro ao carregar detalhes",description:r.message||"NÃ£o foi possÃ­vel carregar os detalhes do envio.",variant:"destructive"}),v(null),g([]),m([]),y(null),{envioId:null,envioNum:null,summary:null,items:[],pendings:[]}}finally{c(!1)}},[n]),S=o.useCallback(async a=>{c(!0);try{const e=await u.getAllItemsByCliente(a);console.log("ðŸ“¦ Resposta do backend (getAllItemsByCliente):",e),console.log("ðŸ“¦ Tipo:",typeof e,"Ã‰ array?",Array.isArray(e)),console.log("ðŸ“¦ Chaves do objeto:",Object.keys(e));const s=Array.isArray(e)?e:[];console.log("ðŸ“¦ Items array length:",s.length);const i=s.filter(t=>t.matched_sku),l=s.filter(t=>!t.matched_sku);console.log("ðŸ“¦ Processados:",i.length,"Pendentes:",l.length);const r=i.map(t=>({id:t.full_raw_id,row_num:t.full_raw_id,codigo_ml:t.envio_num,sku_texto:t.sku_texto,matched_sku:t.matched_sku,qtd:1,processed_at:t.is_emitted?new Date().toISOString():void 0})),d=l.map(t=>({id:t.full_raw_id,row_num:t.full_raw_id,codigo_ml:t.envio_num,sku_texto:t.sku_texto,qtd:1}));return g(r),m(d),v({tot_itens:s.length,tot_qtd:s.length,registrados_itens:i.length,registrados_qtd:i.length,pendentes_itens:l.length,pendentes_qtd:l.length}),y(null),{items:r,pendings:d}}catch(e){return console.error("Erro ao carregar itens do cliente:",e),n({title:"Erro ao carregar itens",description:e.message||"NÃ£o foi possÃ­vel carregar os itens do cliente.",variant:"destructive"}),g([]),m([]),v(null),{items:[],pendings:[]}}finally{c(!1)}},[n]),C=o.useCallback(async a=>{try{const e=await u.matchFullLine(a);return n({title:"Linha confirmada",description:`${e.emitidos} venda(s) emitida(s), ${e.alias_ops} alias criado(s).`}),y(e.envio_id),{ok:!0,envio_id:e.envio_id}}catch(e){return n({title:"Erro ao confirmar",description:e.message||"Erro desconhecido",variant:"destructive"}),{ok:!1}}},[n]),b=o.useCallback(async(a,e)=>{try{return await u.searchSku(a,e)}catch(s){return console.error("Erro na busca de SKU:",s),[]}},[]);return{envios:p,items:h,pendings:f,summary:k,currentEnvioId:E,isLoading:A,loadEnvios:I,loadEnvioDetails:w,loadAllItemsByCliente:S,matchLine:C,searchSku:b}};export{L as u};
