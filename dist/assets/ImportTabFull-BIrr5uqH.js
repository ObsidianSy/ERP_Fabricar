import{a3 as M,r,u as z,a as V,b as O,j as e,A as X,m as K,C,c as F,d as P,P as H,e as G,f as w,S as J,g as Z,h as Q,i as W,k as Y,I as ee,Z as se,_ as ae,B as f,a4 as te,a5 as le,G as D,$ as re,a6 as ne,H as E,F as ie,U as q,o as oe}from"./index-Cc8Dvf1k.js";import{P as ce}from"./progress-CmDOGqJ5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=M("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ue=r.memo(function({onUploadSuccess:N}){const{usuario:i}=z(),[x,I]=r.useState(""),[u,y]=r.useState(""),[o,U]=r.useState(new Date),[c,h]=r.useState(null),[g,j]=r.useState(!1),[v,n]=r.useState(0),[a,T]=r.useState(null),{toast:d}=V(),{data:k}=O("Clientes"),A=s=>{var p;const l=(p=s.target.files)==null?void 0:p[0];if(l){if(!["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/pdf"].includes(l.type)){d({title:"Arquivo inv√°lido",description:"Por favor, selecione um arquivo CSV, Excel ou PDF.",variant:"destructive"});return}h(l)}},L=async()=>{if(!x||!u||!c||!o){d({title:"Campos obrigat√≥rios",description:"Por favor, preencha cliente, n¬∫ envio, data e selecione um arquivo.",variant:"destructive"});return}j(!0),n(0);try{const s=await oe.uploadFileFull(x,u,c,D(o,"yyyy-MM-dd"),(i==null?void 0:i.email)||"usuario@sistema.com",(i==null?void 0:i.nome)||"Usu√°rio Sistema");if(s.import_id){const R="https://docker-opus-unified.q4xusi.easypanel.host",m=new EventSource(`${R}/api/envios/upload-progress/${s.import_id}`);m.onmessage=B=>{try{const t=JSON.parse(B.data),S=t.current;n(S),console.log(`üìä FULL Progresso: ${S}% - ${t.stage} - ${t.message}`),t.stage==="completed"&&(m.close(),n(100),d({title:"‚úÖ Processamento conclu√≠do!",description:t.message||"Arquivo processado com sucesso",duration:5e3})),t.stage==="error"&&(m.close(),n(0),j(!1),d({title:"Erro no processamento",description:t.message||"Falha ao processar arquivo",variant:"destructive",duration:5e3}))}catch(t){console.error("Erro ao processar progresso:",t)}},m.onerror=()=>{m.close(),n(100)},setTimeout(()=>{m.close()},18e4)}else n(100);const l=s.auto_relacionadas||0,p=s.pendentes||0,b=s.total_linhas||s.linhas_processadas||s.linhas||0;T({envioNum:s.envio_num,totalLinhas:b,autoRelacionadas:l,pendentes:p}),d({title:"Upload conclu√≠do",description:`Envio ${s.envio_num} processado com sucesso`}),N&&N({envioNum:s.envio_num,clienteNome:x,pendentes:p}),h(null),j(!1),y("")}catch(s){j(!1),n(0),d({title:"Erro no upload",description:s.message||"Falha ao enviar arquivo. Tente novamente.",variant:"destructive"})}},_=s=>{s.preventDefault();const l=s.dataTransfer.files[0];l&&h(l)},$=s=>{s.preventDefault()};return e.jsxs("div",{className:"space-y-6",children:[a&&e.jsxs(X,{className:"border-green-500/50 bg-green-500/10",children:[e.jsx(de,{className:"h-5 w-5 text-green-600"}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsxs(K,{className:"text-sm",children:[e.jsxs("div",{className:"font-semibold mb-2",children:["Envio ",a.envioNum," importado com sucesso!"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Total de Linhas"}),e.jsx("div",{className:"text-lg font-bold text-foreground",children:a.totalLinhas})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Auto-Relacionados"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:a.autoRelacionadas})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Pendentes"}),e.jsx("div",{className:"text-lg font-bold text-orange-600",children:a.pendentes})]})]}),a.pendentes>0&&e.jsxs("div",{className:"mt-2 text-xs text-orange-600",children:["‚ö†Ô∏è ",a.pendentes," ",a.pendentes===1?"item precisa":"itens precisam"," ser relacionado",a.pendentes===1?"":"s"," manualmente"]})]})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(C,{className:"md:col-span-1",children:[e.jsxs(F,{className:"pb-4",children:[e.jsxs(P,{className:"text-lg flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Importar Envio Full"]}),e.jsx(G,{children:"Upload de arquivo ML Fulfillment"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:["Cliente",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(J,{value:x,onValueChange:I,children:[e.jsx(Z,{className:"w-full",children:e.jsx(Q,{placeholder:"Selecione um cliente"})}),e.jsx(W,{children:k.map(s=>e.jsx(Y,{value:s.Nome,children:s.Nome},s.Nome))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:["N¬∫ Envio",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(ee,{type:"text",placeholder:"Ex: 53293771",value:u,onChange:s=>y(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:["Data de Importa√ß√£o",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:te("w-full justify-start text-left font-normal",!o&&"text-muted-foreground"),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),o?D(o,"PPP",{locale:E}):e.jsx("span",{children:"Selecione uma data"})]})}),e.jsx(re,{className:"w-auto p-0",align:"start",children:e.jsx(ne,{mode:"single",selected:o,onSelect:U,initialFocus:!0,locale:E})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:["Arquivo",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center hover:border-primary/50 hover:bg-muted/50 transition-all cursor-pointer group",onDrop:_,onDragOver:$,onClick:()=>{var s;return(s=document.getElementById("file-input-full"))==null?void 0:s.click()},children:[e.jsx("input",{id:"file-input-full",type:"file",accept:".csv,.xlsx,.xls,.pdf",onChange:A,className:"hidden"}),c?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-full w-fit mx-auto",children:e.jsx(ie,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:c.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(c.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:s=>{s.stopPropagation(),h(null)},children:"Remover arquivo"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-muted rounded-full w-fit mx-auto group-hover:bg-primary/10 transition-colors",children:e.jsx(q,{className:"h-8 w-8 text-muted-foreground group-hover:text-primary transition-colors"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Arraste o arquivo aqui"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ou clique para selecionar"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"CSV, XLSX, PDF (m√°x. 10MB)"})]})]})]})]}),g&&e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:v===100?"‚úÖ Conclu√≠do":"‚è≥ Processando..."}),e.jsxs("span",{className:"font-bold text-primary",children:[v,"%"]})]}),e.jsx(ce,{value:v,className:`h-3 transition-all ${v===100?"bg-green-100":""}`})]}),e.jsx(f,{onClick:L,disabled:!x||!u||!c||g,className:"w-full",size:"default",children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"‚è≥"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Enviar para Fulfillment"]})})]})]}),e.jsxs(C,{children:[e.jsx(F,{className:"pb-3",children:e.jsx(P,{className:"text-base",children:"Instru√ß√µes"})}),e.jsx(w,{children:e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"‚Ä¢"}),e.jsx("span",{children:"Selecione o cliente interno correspondente"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"‚Ä¢"}),e.jsx("span",{children:"Informe o n√∫mero do envio (ex: 53293771)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"‚Ä¢"}),e.jsx("span",{children:"Fa√ßa upload do arquivo ML Full (CSV, XLSX ou PDF)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"‚Ä¢"}),e.jsx("span",{children:"O sistema ir√° processar e normalizar os SKUs automaticamente"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"‚Ä¢"}),e.jsx("span",{children:'SKUs n√£o reconhecidos aparecer√£o em "Pend√™ncias"'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"‚Ä¢"}),e.jsx("span",{children:"Kits s√£o expandidos automaticamente para componentes"})]})]})})]})]})]})});export{ue as ImportTabFull};
